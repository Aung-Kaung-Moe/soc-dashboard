generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

enum Severity {
  Critical
  Medium
  Low
}

enum AlertStatus {
  Open
  Investigating
  Closed
}

enum Role {
  L1
  L2
  Admin
}

enum LogLevel {
  INFO
  WARN
  ERROR
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  passwordHash String
  role         Role

  alertsAssigned Alert[]   @relation("AssignedAlerts")
  auditLogs      AuditLog[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Alert {
  id             String      @id @default(cuid())
  timestamp      DateTime
  sourceIp       String
  destinationIp  String?
  alertType      String
  severity       Severity
  status         AlertStatus
  title          String
  description    String?
  ruleName       String?
  source         String?
  hostname       String?
  user           String?
  tags           Json?
  eventCount     Int         @default(1)
  correlationId  String?

  assignedToId   String?
  assignedTo     User?       @relation("AssignedAlerts", fields: [assignedToId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model LogEntry {
  id        String   @id @default(cuid())
  timestamp DateTime @default(now())
  level     LogLevel
  message   String
  source    String?
  host      String?
  raw       Json?

  createdAt DateTime @default(now())
}

model AuditLog {
  id          String   @id @default(cuid())
  actorUserId String
  actorUser   User     @relation(fields: [actorUserId], references: [id])

  action      String
  entityType  String
  entityId    String

  before      Json?
  after       Json?
  timestamp   DateTime @default(now())
}
